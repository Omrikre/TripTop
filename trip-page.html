<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3410373926763817"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/android-chrome-512x512.png" type="image/x-icon">
  <title>Trip Page | TripTop</title>
  <link rel="stylesheet" href="styles/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
  <div class="navbar">
    <a href="index.html" class="logo"><img style="border-radius: 10px;" src="img/logo.png" width="200px" height="65px"></a>
    <div id="menuDiv">
      <a href="index.html"><i class="fa fa-home"></i> Home</a>
      <a href="search.html"><i class="fa fa-search"></i> Plan Your Trip</a>
      <a href="recommended-trips.html"><i class="fa fa-fw fa-fire"></i>Recommended Trips</a>
      <a href="about-us.html"><i class="fa fa-fw fa-info"></i> About Us</a>
    </div>
  </div>
  
  <h1 class="welcome-title">We found the best trip for you !</h1>

  <form style="text-align: center; max-width: 60%;">
    <a style="float: right; color: black;" href="search.html" title="Edit your trip search"><i class="fas fa-edit edit-icon"></i></a>



    <div id="form-container"></div>

    <script>
      //extract trip data parameter from URL
      const urlParams = new URLSearchParams(window.location.search);
      const tripDataParam = urlParams.get('data');
      const tripData = JSON.parse(tripDataParam);
//       const tripData = {
//   "NumberOfAttractionsPerDay": 1,
//   "amountOfDays": 2,
//   "days": [
//     {
//       "attractions": [
//         {
//           "description": "This is the museum of the Vatican City.",
//           "endTime": "11:30",
//           "name": "The Vatican Museums",
//           "orderInDay": 0,
//           "startTime": "09:00"
//         }
//       ],
//       "orderInTrip": 0
//     },
//     {
//       "attractions": [
//         {
//           "description": "This is a museum located in the Villa Borghese gardens.",
//           "endTime": "16:30",
//           "name": "Galleria Borghese",
//           "orderInDay": 0,
//           "startTime": "14:30"
//         }
//       ],
//       "orderInTrip": 1
//     }
//   ],
//   "destination": "Rome",
//   "endDate": "2023-05-05",
//   "excludeCategories": [
//     "sports"
//   ],
//   "includeCategories": [
//     "museums"
//   ],
//   "startDate": "2023-05-04"
// };
      // generate HTML form based on the trip data
      const formContainer = document.querySelector('#form-container');
      const cityName = tripData.destination;
      const cityNameWithoutSpaces = cityName.replace(/\s/g, '');

      formContainer.innerHTML = `
      <h1 class="welcome-title">Trip Information</h1>
        <form>
          <label style="font-weight:Bold;" for="destination">Destination:</label>
          <span id="destination">${tripData.destination}</span><br><br>
    
          <label style="font-weight:Bold;" for="start_date">Start Date:</label>
          <span id="start_date">${tripData.startDate}</span><br><br>
    
          <label style="font-weight:Bold;" for="end_date">End Date:</label>
          <span id="end_date">${tripData.endDate}</span><br><br>
    
          <table>
            <tr>
              <th>Day Of The Trip</th>
              <th>Attraction Name</th>
              <th>Description</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Google Places Link</th>
            </tr>
            <!-- Generate table rows dynamically based on the trip data -->
            ${tripData.days.map((day, i) => {
              // Add a blank row for every new day
              const blankRow = i > 0 ? '<tr><td colspan="6">&nbsp;</td></tr>' : '';
              return blankRow + day.attractions.map((attraction, j) => {
                return `
                  <tr>
                    <td>Day ${i + 1}</td>
                    <td>${attraction.name}</td>
                    <td>${attraction.description}</td>
                    <td>${attraction.startTime}</td>
                    <td>${attraction.endTime}</td>
                    <td><a style="font-weight:bold" href="https://www.google.com/maps/search/?api=1&query=${attraction.name}+${tripData.destination}" target="_blank">Google Maps Link</a></td>
                  </tr>
                `;
              }).join('');
            }).join('')}
          </table>

    <img style="border-radius: 5px;" height="200" src="https://source.unsplash.com/1600x900/?${cityNameWithoutSpaces}" alt="Trip image">

        </form>
      `;
      const placeName = tripData.destination; // Replace with the name of the place you want to get the coordinates for

// Use OSM Nominatim to get the coordinates of the place
fetch(`https://nominatim.openstreetmap.org/search?q=${placeName}&format=json`)
  .then(response => response.json())
  .then(data => {
    if (data.length > 0) {
      // Get the latitude and longitude of the first result (assuming there is one)
      const lat = data[0].lat;
      const lon = data[0].lon;

      // Create the map
      var map = L.map('map').setView([lat, lon], 13);

      // Add a tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
        maxZoom: 18,
      }).addTo(map);

      // Loop through each day of the trip
      tripData.days.forEach(day => {
        // Loop through each attraction on the day
        day.attractions.forEach(attraction => {
          // Use OSM Nominatim to get the coordinates of the attraction
          fetch(`https://nominatim.openstreetmap.org/search?q=${attraction.name}, ${tripData.destination}&format=json`)
            .then(response => response.json())
            .then(data => {
              if (data.length > 0) {
                // Get the latitude and longitude of the first result (assuming there is one)
                const lat = data[0].lat;
                const lon = data[0].lon;

                // Add a marker to the map for the attraction
                var marker = L.marker([lat, lon]).addTo(map);

                // Add a popup to the marker with the attraction's name and description
                marker.bindPopup(`<h3>${attraction.name}</h3><p>${attraction.description}</p>`).openPopup();
              }
            });
        });
      });
    }
  });
    </script>
    
    <!-- <h2>Destination</h2>
    <p>New York City</p>
    
    <h2>Trip Dates</h2>
    <p>March 30, 2023 - April 02, 2023</p>
    
    <h2>Daily Budget</h2>
    <p>$0 - $50</p>
    
    <table style="border:groove;">
      <thead>
        <tr>
          <th>Date/Time</th>
          <th>Activity</th>
          <th>More information about the place</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom: double;">
          <td></td>
          <td style="font-weight: bold; font-size: larger;">Day 1</td>
          <td></td>
        </tr>
        <tr>
          <td>April 22, 10am</td>
          <td>Visit the Empire State Building</td>
          <td><a href="https://www.google.com/maps?q=empire+state+building" target="_blank">Empire State Building</a></td>
        </tr>
        <tr>
          <td>April 22, 12pm</td>
          <td>Lunch at Katz's Delicatessen</td>
          <td><a href="https://www.google.com/maps?q=katz%27s+delicatessen" target="_blank">Katz's Delicatessen</a></td>
        </tr>
        <tr>
          <td>April 22, 2pm</td>
          <td>Explore Central Park</td>
          <td><a href="https://www.google.com/maps?q=central+park" target="_blank">Central Park</a></td>
        </tr>
        <tr>
          <td>April 22, 4pm</td>
          <td>Visit the Metropolitan Museum of Art</td>
          <td><a href="https://www.google.com/maps?q=the+metropolitan+museum+of+art" target="_blank">Metropolitan Museum of Art</a></td>
        </tr>
        <tr>
          <td>April 22, 6pm</td>
          <td>Dinner at Peter Luger Steak House</td>
          <td><a href="https://www.google.com/maps?q=peter+luger+steak+house" target="_blank">Peter Luger Steak House</a></td>
        </tr>
        <tr>
          <td>April 22, 8pm</td>
          <td>See a Broadway show</td>
          <td><a href="https://www.google.com/maps?q=broadway+shows">Broadway show</a></td>
        </tr>
        <tr style="border-bottom: double;">
          <td></td>
          <td style="font-weight: bold; font-size: larger;">Day 2</td>
          <td></td>
        </tr>
        <tr>
          <td>April 23, 12pm</td>
          <td>Lunch at Katz's Delicatessen</td>
          <td><a href="https://www.google.com/maps?q=katz%27s+delicatessen" target="_blank">Katz's Delicatessen</a></td>
        </tr>
        <tr>
          <td>April 23, 2pm</td>
          <td>Explore Central Park</td>
          <td><a href="https://www.google.com/maps?q=central+park" target="_blank">Central Park</a></td>
        </tr>
        <tr>
          <td>April 23, 4pm</td>
          <td>Visit the Metropolitan Museum of Art</td>
          <td><a href="https://www.google.com/maps?q=the+metropolitan+museum+of+art" target="_blank">Metropolitan Museum of Art</a></td>
        </tr>
        <tr>
          <td>April 23, 6pm</td>
          <td>Dinner at Peter Luger Steak House</td>
          <td><a href="https://www.google.com/maps?q=peter+luger+steak+house" target="_blank">Peter Luger Steak House</a></td>
        </tr>
        <tr>
          <td>April 23, 8pm</td>
          <td>See a Broadway show</td>
          <td><a href="https://www.google.com/maps?q=broadway+shows">Broadway show</a></td>
        </tr>
        <tr style="border-bottom: double;">
          <td></td>
          <td style="font-weight: bold; font-size: larger;">Day 3</td>
          <td></td>
        </tr>
      <tr>
        <td>April 24, 12pm</td>
        <td>Lunch at Katz's Delicatessen</td>
        <td><a href="https://www.google.com/maps?q=katz%27s+delicatessen" target="_blank">Katz's Delicatessen</a></td>
      </tr>
      <tr>
        <td>April 24, 2pm</td>
        <td>Explore Central Park</td>
        <td><a href="https://www.google.com/maps?q=central+park" target="_blank">Central Park</a></td>
      </tr>
      <tr>
        <td>April 24, 4pm</td>
        <td>Visit the Metropolitan Museum of Art</td>
        <td><a href="https://www.google.com/maps?q=the+metropolitan+museum+of+art" target="_blank">Metropolitan Museum of Art</a></td>
      </tr>
      <tr>
        <td>April 24, 6pm</td>
        <td>Dinner at Peter Luger Steak House</td>
        <td><a href="https://www.google.com/maps?q=peter+luger+steak+house" target="_blank">Peter Luger Steak House</a></td>
      </tr>
      <tr>
        <td>April 24, 8pm</td>
        <td>See a Broadway show</td>
        <td><a href="https://www.google.com/maps?q=broadway+shows">Broadway show</a></td>
      </tr>
      </tbody>
    </table>
     -->
    
    <br><br>
    <button><a onclick="event.preventDefault(); downloadICal(tripData);" download>Export to ICS</a></button>
    <br><br>
    <div id="map"></div>
    <br><br>
    <div class="rank">
      <label for="tripRank">Rate your trip recommendation:</label>
      <input type="hidden" name="tripRank" id="tripRank" value="0">
      <i class="far fa-star" data-star="1"></i>
      <i class="far fa-star" data-star="2"></i>
      <i class="far fa-star" data-star="3"></i>
      <i class="far fa-star" data-star="4"></i>
      <i class="far fa-star" data-star="5"></i>
    </div>
  </form>
  <br><br><br>
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-4" style="float: left;">
          <h3>Contact Us</h3>
          <p><i class="fas fa-map-marker-alt"></i> The Academic College of Tel AvivâYaffo</p>
          <p><i class="fas fa-envelope"></i> noreply@triptop.com</p>
          <p><i class="fas fa-phone"></i> +972-54678910</p>
        </div>
        <div class="col-md-4" style="float: right;">
          <h3>Explore</h3>
          <ul>
            <li><a href="recommended-trips.html">Recommended Trips</a></li>
            <li><a href="about-us.html">About Us</a></li>
            <li><a href="FAQ-page.html">FAQ</a></li>
          </ul>
        </div>
      </div>
  
    </div>
    <br><br><br><br><br><br><br><br><br>
  <div style="text-align: center;">
    <ul class="social-media">
      <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
      <li><a href="#"><i class="fab fa-twitter"></i></a></li>
      <li><a href="#"><i class="fab fa-instagram"></i></a></li>
      <li><a href="#"><i class="fab fa-pinterest"></i></a></li>
    </ul>
  </div>
    <p style="text-align: center;">&copy; 2023 TripTop team. All rights reserved.</p>
  </footer>
  <script src="export-trip-to-ics.js"></script>
  <script src="rank-trip-script.js"></script>
</body>

</html>
